{
  "version": "0.1.0",
  "name": "onchain_academy",
  "instructions": [
    {
      "name": "initialize",
      "docs": ["One-time initialization. Creates Config PDA, XP mint, and auto-registers authority as a MinterRole."],
      "accounts": [
        { "name": "config", "isMut": true, "isSigner": false, "docs": ["Config PDA (singleton)"] },
        { "name": "xpMint", "isMut": true, "isSigner": true, "docs": ["XP Mint (Token-2022, NonTransferable)"] },
        { "name": "authority", "isMut": true, "isSigner": true, "docs": ["Program authority"] },
        { "name": "backendMinterRole", "isMut": true, "isSigner": false, "docs": ["Auto-created minter role for authority"] },
        { "name": "systemProgram", "isMut": false, "isSigner": false },
        { "name": "tokenProgram", "isMut": false, "isSigner": false }
      ],
      "args": []
    },
    {
      "name": "updateConfig",
      "docs": ["Rotate backend signer. Optionally deactivate old MinterRole via remaining accounts."],
      "accounts": [
        { "name": "config", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true }
      ],
      "args": [
        { "name": "changes", "type": { "defined": "ConfigUpdate" } }
      ]
    },
    {
      "name": "createCourse",
      "docs": ["Create a new course. Requires admin authority."],
      "accounts": [
        { "name": "course", "isMut": true, "isSigner": false },
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "authority", "isMut": true, "isSigner": true },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "params", "type": { "defined": "CreateCourseParams" } }
      ]
    },
    {
      "name": "updateCourse",
      "docs": ["Update course settings. Admin only."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "course", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true }
      ],
      "args": [
        { "name": "changes", "type": { "defined": "CourseUpdate" } }
      ]
    },
    {
      "name": "registerMinter",
      "docs": ["Register an external XP minter with per-call cap. Admin only."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "minterRole", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true },
        { "name": "payer", "isMut": true, "isSigner": true },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "params", "type": { "defined": "RegisterMinterParams" } }
      ]
    },
    {
      "name": "revokeMinter",
      "docs": ["Revoke a minter role. Admin only."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "minterRole", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": true, "isSigner": true }
      ],
      "args": []
    },
    {
      "name": "createAchievementType",
      "docs": ["Create a new achievement type with Metaplex Core collection. Admin only."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "achievementType", "isMut": true, "isSigner": false },
        { "name": "collection", "isMut": true, "isSigner": true },
        { "name": "authority", "isMut": false, "isSigner": true },
        { "name": "payer", "isMut": true, "isSigner": true },
        { "name": "mplCoreProgram", "isMut": false, "isSigner": false },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "params", "type": { "defined": "CreateAchievementTypeParams" } }
      ]
    },
    {
      "name": "deactivateAchievementType",
      "docs": ["Deactivate an achievement type. Admin only."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "achievementType", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true }
      ],
      "args": []
    },
    {
      "name": "enroll",
      "docs": ["Learner enrolls in a course. Checks prerequisites via remaining accounts if present."],
      "accounts": [
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": true, "isSigner": false },
        { "name": "learner", "isMut": true, "isSigner": true },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "courseId", "type": "string" }
      ]
    },
    {
      "name": "closeEnrollment",
      "docs": ["Learner closes enrollment and reclaims rent. 24h cooldown if incomplete."],
      "accounts": [
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": true, "isSigner": false },
        { "name": "learner", "isMut": true, "isSigner": true }
      ],
      "args": []
    },
    {
      "name": "completeLesson",
      "docs": ["Backend marks a lesson complete and mints XP. Backend signer required."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": true, "isSigner": false },
        { "name": "learner", "isMut": false, "isSigner": false },
        { "name": "learnerTokenAccount", "isMut": true, "isSigner": false },
        { "name": "xpMint", "isMut": true, "isSigner": false },
        { "name": "backendSigner", "isMut": false, "isSigner": true },
        { "name": "tokenProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "lessonIndex", "type": "u8" }
      ]
    },
    {
      "name": "finalizeCourse",
      "docs": ["Backend finalizes a course. Verifies all lessons, awards 50% bonus XP."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": true, "isSigner": false },
        { "name": "learner", "isMut": false, "isSigner": false },
        { "name": "learnerTokenAccount", "isMut": true, "isSigner": false },
        { "name": "creatorTokenAccount", "isMut": true, "isSigner": false },
        { "name": "creator", "isMut": false, "isSigner": false },
        { "name": "xpMint", "isMut": true, "isSigner": false },
        { "name": "backendSigner", "isMut": false, "isSigner": true },
        { "name": "tokenProgram", "isMut": false, "isSigner": false }
      ],
      "args": []
    },
    {
      "name": "issueCredential",
      "docs": ["Backend issues a soulbound Metaplex Core credential NFT. Requires finalize_course first."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": true, "isSigner": false },
        { "name": "learner", "isMut": false, "isSigner": false },
        { "name": "credentialAsset", "isMut": true, "isSigner": true },
        { "name": "trackCollection", "isMut": false, "isSigner": false },
        { "name": "payer", "isMut": true, "isSigner": true },
        { "name": "backendSigner", "isMut": false, "isSigner": true },
        { "name": "mplCoreProgram", "isMut": false, "isSigner": false },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "credentialName", "type": "string" },
        { "name": "metadataUri", "type": "string" },
        { "name": "coursesCompleted", "type": "u32" },
        { "name": "totalXp", "type": { "defined": "I80F48" } }
      ]
    },
    {
      "name": "upgradeCredential",
      "docs": ["Backend updates an existing credential NFT attributes."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "course", "isMut": false, "isSigner": false },
        { "name": "enrollment", "isMut": false, "isSigner": false },
        { "name": "learner", "isMut": false, "isSigner": false },
        { "name": "credentialAsset", "isMut": true, "isSigner": false },
        { "name": "trackCollection", "isMut": false, "isSigner": false },
        { "name": "payer", "isMut": true, "isSigner": true },
        { "name": "backendSigner", "isMut": false, "isSigner": true },
        { "name": "mplCoreProgram", "isMut": false, "isSigner": false },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "newName", "type": "string" },
        { "name": "newUri", "type": "string" },
        { "name": "coursesCompleted", "type": "u32" },
        { "name": "totalXp", "type": { "defined": "I80F48" } }
      ]
    },
    {
      "name": "rewardXp",
      "docs": ["Registered minter mints XP to a recipient within per-call cap."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "minterRole", "isMut": true, "isSigner": false },
        { "name": "xpMint", "isMut": true, "isSigner": false },
        { "name": "recipientTokenAccount", "isMut": true, "isSigner": false },
        { "name": "minter", "isMut": false, "isSigner": true },
        { "name": "tokenProgram", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "amount", "type": { "defined": "I80F48" } },
        { "name": "reason", "type": "string" }
      ]
    },
    {
      "name": "awardAchievement",
      "docs": ["Registered minter awards achievement NFT + XP to recipient."],
      "accounts": [
        { "name": "config", "isMut": false, "isSigner": false },
        { "name": "achievementType", "isMut": true, "isSigner": false },
        { "name": "achievementReceipt", "isMut": true, "isSigner": false },
        { "name": "minterRole", "isMut": true, "isSigner": false },
        { "name": "asset", "isMut": true, "isSigner": true },
        { "name": "collection", "isMut": false, "isSigner": false },
        { "name": "recipient", "isMut": false, "isSigner": false },
        { "name": "recipientTokenAccount", "isMut": true, "isSigner": false },
        { "name": "xpMint", "isMut": true, "isSigner": false },
        { "name": "payer", "isMut": true, "isSigner": true },
        { "name": "minter", "isMut": false, "isSigner": true },
        { "name": "mplCoreProgram", "isMut": false, "isSigner": false },
        { "name": "tokenProgram", "isMut": false, "isSigner": false },
        { "name": "systemProgram", "isMut": false, "isSigner": false }
      ],
      "args": []
    }
  ],
  "accounts": [
    {
      "name": "Config",
      "docs": ["Singleton PDA storing program configuration and XP mint."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "authority", "type": "publicKey", "docs": ["Program authority"] },
          { "name": "backendSigner", "type": "publicKey", "docs": ["Backend signer for lessons/credentials"] },
          { "name": "xpMint", "type": "publicKey", "docs": ["XP Mint (Token-2022)"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "Course",
      "docs": ["Course metadata and lesson tracking."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "courseId", "type": "string", "docs": ["Unique course identifier"] },
          { "name": "creator", "type": "publicKey", "docs": ["Course creator"] },
          { "name": "contentTxId", "type": { "array": ["u8", 32] }, "docs": ["Arweave TX ID for content"] },
          { "name": "lessonCount", "type": "u8", "docs": ["Total lessons in course"] },
          { "name": "difficulty", "type": "u8", "docs": ["Difficulty level 0-3"] },
          { "name": "xpPerLesson", "type": "u32", "docs": ["XP awarded per lesson"] },
          { "name": "trackId", "type": "u32", "docs": ["Track identifier"] },
          { "name": "trackLevel", "type": "u32", "docs": ["Level within track"] },
          { "name": "prerequisite", "type": { "option": "publicKey" }, "docs": ["Optional prerequisite course"] },
          { "name": "creatorRewardXp", "type": "u32", "docs": ["XP awarded to creator"] },
          { "name": "minCompletionsForReward", "type": "u32", "docs": ["Min completions to trigger creator reward"] },
          { "name": "completionCount", "type": "u32", "docs": ["Total number of completions"] },
          { "name": "isActive", "type": "bool", "docs": ["Course active flag"] },
          { "name": "createdAt", "type": "i64", "docs": ["Creation timestamp"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "Enrollment",
      "docs": ["Learner's enrollment tracking progress with bitmap of completed lessons."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "courseId", "type": "string", "docs": ["Course identifier"] },
          { "name": "learner", "type": "publicKey", "docs": ["Learner wallet"] },
          { "name": "lessonFlags", "type": { "array": ["u64", 4] }, "docs": ["256-bit bitmap of completed lessons"] },
          { "name": "enrolledAt", "type": "i64", "docs": ["Enrollment timestamp"] },
          { "name": "completedAt", "type": { "option": "i64" }, "docs": ["Completion timestamp"] },
          { "name": "credentialAsset", "type": { "option": "publicKey" }, "docs": ["Issued credential NFT"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "MinterRole",
      "docs": ["XP minter role with per-call cap."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "minter", "type": "publicKey", "docs": ["Minter public key"] },
          { "name": "label", "type": "string", "docs": ["Role label (e.g. 'irl-events')"] },
          { "name": "maxXpPerCall", "type": { "defined": "I80F48" }, "docs": ["Per-call XP cap"] },
          { "name": "totalXpMinted", "type": { "defined": "I80F48" }, "docs": ["Total minted to date"] },
          { "name": "isActive", "type": "bool", "docs": ["Role active flag"] },
          { "name": "createdAt", "type": "i64", "docs": ["Creation timestamp"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "AchievementType",
      "docs": ["Achievement type config with Metaplex Core collection reference."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "achievementId", "type": "string", "docs": ["Unique achievement identifier"] },
          { "name": "name", "type": "string", "docs": ["Achievement name"] },
          { "name": "metadataUri", "type": "string", "docs": ["Metadata URI for collection"] },
          { "name": "collection", "type": "publicKey", "docs": ["Metaplex Core collection"] },
          { "name": "currentSupply", "type": "u32", "docs": ["Current awards issued"] },
          { "name": "maxSupply", "type": "u32", "docs": ["Max awards allowed"] },
          { "name": "xpReward", "type": "u32", "docs": ["XP awarded per achievement"] },
          { "name": "isActive", "type": "bool", "docs": ["Achievement active flag"] },
          { "name": "createdAt", "type": "i64", "docs": ["Creation timestamp"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "AchievementReceipt",
      "docs": ["Record of achievement award to prevent double awards."],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "achievementId", "type": "string", "docs": ["Achievement identifier"] },
          { "name": "recipient", "type": "publicKey", "docs": ["Award recipient"] },
          { "name": "asset", "type": "publicKey", "docs": ["Metaplex Core asset NFT"] },
          { "name": "awardedAt", "type": "i64", "docs": ["Award timestamp"] },
          { "name": "bump", "type": "u8" }
        ]
      }
    }
  ],
  "types": [
    {
      "name": "ConfigUpdate",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "newBackendSigner", "type": { "option": "publicKey" } }
        ]
      }
    },
    {
      "name": "CreateCourseParams",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "courseId", "type": "string" },
          { "name": "creator", "type": "publicKey" },
          { "name": "contentTxId", "type": { "array": ["u8", 32] } },
          { "name": "lessonCount", "type": "u8" },
          { "name": "difficulty", "type": "u8" },
          { "name": "xpPerLesson", "type": "u32" },
          { "name": "trackId", "type": "u32" },
          { "name": "trackLevel", "type": "u32" },
          { "name": "prerequisite", "type": { "option": "publicKey" } },
          { "name": "creatorRewardXp", "type": "u32" },
          { "name": "minCompletionsForReward", "type": "u32" }
        ]
      }
    },
    {
      "name": "CourseUpdate",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "newContentTxId", "type": { "option": { "array": ["u8", 32] } } },
          { "name": "newIsActive", "type": { "option": "bool" } },
          { "name": "newXpPerLesson", "type": { "option": "u32" } },
          { "name": "newCreatorRewardXp", "type": { "option": "u32" } },
          { "name": "newMinCompletionsForReward", "type": { "option": "u32" } }
        ]
      }
    },
    {
      "name": "RegisterMinterParams",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "minter", "type": "publicKey" },
          { "name": "label", "type": "string" },
          { "name": "maxXpPerCall", "type": { "defined": "I80F48" } }
        ]
      }
    },
    {
      "name": "CreateAchievementTypeParams",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "achievementId", "type": "string" },
          { "name": "name", "type": "string" },
          { "name": "metadataUri", "type": "string" },
          { "name": "maxSupply", "type": "u32" },
          { "name": "xpReward", "type": "u32" }
        ]
      }
    },
    {
      "name": "I80F48",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "value", "type": "i128" }
        ]
      }
    }
  ],
  "events": [
    { "name": "ConfigUpdated", "fields": [{ "name": "authority", "type": "publicKey" }] },
    { "name": "CourseCreated", "fields": [{ "name": "courseId", "type": "string" }, { "name": "creator", "type": "publicKey" }] },
    { "name": "CourseUpdated", "fields": [{ "name": "courseId", "type": "string" }] },
    { "name": "Enrolled", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "courseId", "type": "string" }] },
    { "name": "LessonCompleted", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "courseId", "type": "string" }, { "name": "lessonIndex", "type": "u8" }, { "name": "xpEarned", "type": "u32" }, { "name": "timestamp", "type": "i64" }] },
    { "name": "CourseFinalized", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "courseId", "type": "string" }, { "name": "totalXp", "type": "u32" }, { "name": "bonusXp", "type": "u32" }, { "name": "creator", "type": "publicKey" }, { "name": "creatorXp", "type": "u32" }] },
    { "name": "EnrollmentClosed", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "courseId", "type": "string" }] },
    { "name": "CredentialIssued", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "asset", "type": "publicKey" }] },
    { "name": "CredentialUpgraded", "fields": [{ "name": "learner", "type": "publicKey" }, { "name": "asset", "type": "publicKey" }] },
    { "name": "MinterRegistered", "fields": [{ "name": "minter", "type": "publicKey" }, { "name": "label", "type": "string" }] },
    { "name": "MinterRevoked", "fields": [{ "name": "minter", "type": "publicKey" }] },
    { "name": "XpRewarded", "fields": [{ "name": "recipient", "type": "publicKey" }, { "name": "amount", "type": "u32" }, { "name": "reason", "type": "string" }] },
    { "name": "AchievementAwarded", "fields": [{ "name": "achievementId", "type": "string" }, { "name": "recipient", "type": "publicKey" }, { "name": "asset", "type": "publicKey" }, { "name": "xpReward", "type": "u32" }] },
    { "name": "AchievementTypeCreated", "fields": [{ "name": "achievementId", "type": "string" }] },
    { "name": "AchievementTypeDeactivated", "fields": [{ "name": "achievementId", "type": "string" }] }
  ],
  "errors": [
    { "code": 6000, "name": "CourseNotActive", "msg": "Course is not active" },
    { "code": 6001, "name": "LessonOutOfBounds", "msg": "Lesson index out of bounds" },
    { "code": 6002, "name": "LessonAlreadyCompleted", "msg": "Lesson already completed" },
    { "code": 6003, "name": "CourseNotCompleted", "msg": "Not all lessons completed" },
    { "code": 6004, "name": "CourseAlreadyFinalized", "msg": "Course already finalized" },
    { "code": 6005, "name": "CourseNotFinalized", "msg": "Course not yet finalized" },
    { "code": 6006, "name": "PrerequisiteNotMet", "msg": "Prerequisite course not completed" },
    { "code": 6007, "name": "UnenrollCooldown", "msg": "24h cooldown for incomplete courses" },
    { "code": 6008, "name": "MinterNotActive", "msg": "Minter role is not active" },
    { "code": 6009, "name": "MinterAmountExceeded", "msg": "Amount exceeds per-call XP cap" },
    { "code": 6010, "name": "AchievementNotActive", "msg": "Achievement is not active" },
    { "code": 6011, "name": "AchievementSupplyExhausted", "msg": "Max supply reached" },
    { "code": 6012, "name": "InvalidAmount", "msg": "Invalid amount" },
    { "code": 6013, "name": "Unauthorized", "msg": "Unauthorized" },
    { "code": 6014, "name": "AlreadyAwarded", "msg": "Achievement already awarded to recipient" }
  ]
}
